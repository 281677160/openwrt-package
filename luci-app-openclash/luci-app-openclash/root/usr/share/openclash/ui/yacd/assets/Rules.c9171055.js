var T=Object.defineProperty,F=Object.defineProperties;var S=Object.getOwnPropertyDescriptors;var _=Object.getOwnPropertySymbols;var $=Object.prototype.hasOwnProperty,A=Object.prototype.propertyIsEnumerable;var R=(e,t,r)=>t in e?T(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,u=(e,t)=>{for(var r in t||(t={}))$.call(t,r)&&R(e,r,t[r]);if(_)for(var r of _(t))A.call(t,r)&&R(e,r,t[r]);return e},v=(e,t)=>F(e,S(t));import{e as q,u as E,N as L,U as P,V as x,r as i,k as I,R as o}from"./vendor.3cf270b6.js";import{a as Q,V as W}from"./index.esm.5b55aaed.js";import{t as h,E as z,B as D,c as U,g as V,C as j}from"./index.d6596dd6.js";import{R as w,T as H}from"./TextFitler.97029c74.js";import{f as M}from"./index.afdc8976.js";import{F as O,p as G}from"./Fab.78b2c04b.js";import{u as J}from"./useRemainingViewPortHeight.91bbcf1d.js";import"./debounce.76599460.js";function K(e){const t=e.providers,r=Object.keys(t),s={};for(let n=0;n<r.length;n++){const a=r[n];s[a]=v(u({},t[a]),{idx:n})}return{byName:s,names:r}}async function X(e,t){const{url:r,init:s}=h(t);let n={providers:{}};try{const a=await fetch(r+e,s);a.ok&&(n=await a.json())}catch(a){console.log("failed to GET /providers/rules",a)}return K(n)}async function N({name:e,apiConfig:t}){const{url:r,init:s}=h(t);try{return(await fetch(r+`/providers/rules/${e}`,u({method:"PUT"},s))).ok}catch(n){return console.log("failed to PUT /providers/rules/:name",n),!1}}async function Y({names:e,apiConfig:t}){for(let r=0;r<e.length;r++)await N({name:e[r],apiConfig:t})}var Z=function(e,t,r,s,n,a,l,d){if(!e){var c;if(t===void 0)c=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var f=[r,s,n,a,l,d],B=0;c=new Error(t.replace(/%s/g,function(){return f[B++]})),c.name="Invariant Violation"}throw c.framesToPop=1,c}},ee=Z;function te(e){return ee(e.rules&&e.rules.length>=0,"there is no valid rules list in the rules API response"),e.rules.map((t,r)=>v(u({},t),{id:r}))}async function re(e,t){let r={rules:[]};try{const{url:s,init:n}=h(t),a=await fetch(s+e,n);a.ok&&(r=await a.json())}catch(s){console.log("failed to fetch rules",s)}return te(r)}const b=q({key:"ruleFilterText",default:""});function ne(e,t){const r=P(),{mutate:s,isLoading:n}=x(N,{onSuccess:()=>{r.invalidateQueries("/providers/rules")}});return[l=>{l.preventDefault(),s({name:e,apiConfig:t})},n]}function se(e){const t=P(),{data:r}=C(e),{mutate:s,isLoading:n}=x(Y,{onSuccess:()=>{t.invalidateQueries("/providers/rules")}});return[l=>{l.preventDefault(),s({names:r.names,apiConfig:e})},n]}function C(e){return E(["/providers/rules",e],()=>X("/providers/rules",e))}function ae(e){const{data:t,isFetching:r}=E(["/rules",e],()=>re("/rules",e)),{data:s}=C(e),[n]=L(b);if(n==="")return{rules:t,provider:s,isFetching:r};{const a=n.toLowerCase();return{rules:t.filter(l=>l.payload.toLowerCase().indexOf(a)>=0),isFetching:r,provider:{byName:s.byName,names:s.names.filter(l=>l.toLowerCase().indexOf(a)>=0)}}}}const oe="_RuleProviderItem_ly9yn_1",le="_left_ly9yn_7",ie="_middle_ly9yn_14",ce="_gray_ly9yn_20",ue="_refreshButtonWrapper_ly9yn_24";var m={RuleProviderItem:oe,left:le,middle:ie,gray:ce,refreshButtonWrapper:ue};function me({idx:e,name:t,vehicleType:r,behavior:s,updatedAt:n,ruleCount:a,apiConfig:l}){const[d,c]=ne(t,l),f=M(new Date(n),new Date);return i.exports.createElement("div",{className:m.RuleProviderItem},i.exports.createElement("span",{className:m.left},e),i.exports.createElement("div",{className:m.middle},i.exports.createElement(z,{name:t,type:`${r} / ${s}`}),i.exports.createElement("div",{className:m.gray},a<2?`${a} rule`:`${a} rules`),i.exports.createElement("small",{className:m.gray},"Updated ",f," ago")),i.exports.createElement("span",{className:m.refreshButtonWrapper},i.exports.createElement(D,{onClick:d,disabled:c},i.exports.createElement(w,{isRotating:c}))))}function de({apiConfig:e}){const[t,r]=se(e),{t:s}=I();return i.exports.createElement(O,{icon:i.exports.createElement(w,{isRotating:r}),text:s("update_all_rule_provider"),style:G,onClick:t})}const fe="_rule_1ymqx_1",pe="_left_1ymqx_12",ve="_a_1ymqx_19",ye="_b_1ymqx_26",he="_type_1ymqx_37";var p={rule:fe,left:pe,a:ve,b:ye,type:he};const y={_default:"#59caf9",DIRECT:"#f5bc41",REJECT:"#cb3166"};function _e({proxy:e}){let t=y._default;return y[e]&&(t=y[e]),{color:t}}function Re({type:e,payload:t,proxy:r,id:s}){const n=_e({proxy:r});return o.createElement("div",{className:p.rule},o.createElement("div",{className:p.left},s),o.createElement("div",null,o.createElement("div",{className:p.b},t),o.createElement("div",{className:p.a},o.createElement("div",{className:p.type},e),o.createElement("div",{style:n},r))))}const ge="_header_1j1w3_1",Ee="_RuleProviderItemWrapper_1j1w3_17";var k={header:ge,RuleProviderItemWrapper:Ee};const{memo:Pe}=o,g=30;function xe(e,{rules:t,provider:r}){const s=r.names.length;return e<s?r.names[e]:t[e-s].id}function Ie({provider:e}){return function(r){const s=e.names.length;return r<s?90:80}}const we=Pe(({index:e,style:t,data:r})=>{const{rules:s,provider:n,apiConfig:a}=r,l=n.names.length;if(e<l){const c=n.names[e],f=n.byName[c];return o.createElement("div",{style:t,className:k.RuleProviderItemWrapper},o.createElement(me,u({apiConfig:a},f)))}const d=s[e-l];return o.createElement("div",{style:t},o.createElement(Re,u({},d)))},Q),Ne=e=>({apiConfig:V(e)});var Le=U(Ne)(be);function be({apiConfig:e}){const[t,r]=J(),{rules:s,provider:n}=ae(e),a=Ie({provider:n}),{t:l}=I();return o.createElement("div",null,o.createElement("div",{className:k.header},o.createElement(j,{title:l("Rules")}),o.createElement(H,{placeholder:"Filter",textAtom:b})),o.createElement("div",{ref:t,style:{paddingBottom:g}},o.createElement(W,{height:r-g,width:"100%",itemCount:s.length+n.names.length,itemSize:a,itemData:{rules:s,provider:n,apiConfig:e},itemKey:xe},we)),n&&n.names&&n.names.length>0?o.createElement(de,{apiConfig:e}):null)}export{Le as default};
